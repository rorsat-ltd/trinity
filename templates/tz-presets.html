{% extends "base.html" %}

{% block content %}
<!-- timezone nav bar -->
<div class="govuk-service-navigation" data-module="govuk-service-navigation">
    <div class="govuk-width-container">
        <div class="govuk-service-navigation__container">
            <nav aria-label="Menu" class="govuk-service-navigation__wrapper">
                <ul class="govuk-service-navigation__list" id="navigation">
                    <!--<li class="govuk-service-navigation__item ">
                        <a class="govuk-service-navigation__link" href="/timezones" aria-current="true">
                            Custom
                        </a>
                    </li> -->
                    <li class="govuk-service-navigation__item govuk-service-navigation__item">
                        <a class="govuk-service-navigation__link" href="/tz/custom">
                            <strong class="govuk-service-navigation__fallback">Custom</strong>
                        </a>
                    </li>
                    <!--<li class="govuk-service-navigation__item">
            <a class="govuk-service-navigation__link" href="#">
              Navigation item 3
            </a>
          </li>-->
                </ul>
            </nav>
        </div>
    </div>
</div>



<div class="govuk-width-container app-width-container">
    <div class="govuk-phase-banner">

        <p class="govuk-phase-banner__content">
            <strong class="govuk-tag govuk-phase-banner__content__tag govuk-phase-banner-tag-green">
                Working
            </strong>
            <strong class="govuk-tag govuk-phase-banner__content__tag">
                Beta
            </strong>

            <span class="govuk-phase-banner__text">
                This is a new service â€“ your <a class="govuk-link" href="#">feedback</a> will help us to improve it.
            </span>
        </p>
    </div>
</div>



<div class="govuk-width-container">
    <main class="govuk-main-wrapper">
        <div class="govuk-grid-row">
            <div class="govuk-grid-column-full">
                <h1 class="govuk-heading-xl">Presets</h1>
                <p class="govuk-body">Use the buttons below to quickly calculate the time in a different timezone.</p>
            </div>
        </div>
        <div class="govuk-grid-row">

            <div class="govuk-form-group govuk-grid-column-one-half"> <!--source time-->
                <label class="govuk-label govuk-fieldset__legend--m">
                    Source time
                </label>
                <div id=" src-time-hint" class="govuk-hint">
                    Defaults to system time.
                </div>
                <div class="govuk-input__wrapper">

                    <input class="govuk-input govuk-input--width-4 govuk-input--extra-letter-spacing" id="src-time"
                        name="src-time" type="text" spellcheck="false">
                    <div class="govuk-input__suffix" aria-hidden="true">HHMM</div>
                </div>
            </div>
            <div class="govuk-form-group govuk-grid-column-one-half"> <!--source date-->
                <fieldset class="govuk-fieldset" role="group" aria-describedby="src-date-hint">
                    <legend class="govuk-fieldset__legend govuk-fieldset__legend--m" style="margin-bottom: 0;">
                        <h2 class="govuk-fieldset__heading " style="margin-bottom: 15px;">
                            Source date
                        </h2>
                    </legend>
                    <div class="govuk-date-input" id="src-date">
                        <div class="govuk-date-input__item">
                            <div class="govuk-form-group">
                                <label class="govuk-label govuk-date-input__label " for="src-date-day"
                                    style="margin-bottom: 10px;">
                                    Day
                                </label>
                                <input
                                    class="govuk-input govuk-date-input__input govuk-input--width-2 govuk-input--extra-letter-spacing"
                                    id="src-date-day" name="src-date-day" type="text" inputmode="numeric">
                            </div>
                        </div>
                        <div class="govuk-date-input__item">
                            <div class="govuk-form-group">
                                <label class="govuk-label govuk-date-input__label" for="src-date-month"
                                    style="margin-bottom: 10px;">
                                    Month
                                </label>
                                <input
                                    class="govuk-input govuk-date-input__input govuk-input--width-2 govuk-input--extra-letter-spacing"
                                    id="src-date-month" name="src-date-month" type="text" inputmode="numeric">
                            </div>
                        </div>
                        <div class="govuk-date-input__item">
                            <div class="govuk-form-group">
                                <label class="govuk-label govuk-date-input__label" for="src-date-year"
                                    style="margin-bottom: 10px;">
                                    Year
                                </label>
                                <input
                                    class="govuk-input govuk-date-input__input govuk-input--width-4 govuk-input--extra-letter-spacing"
                                    id="src-date-year" name="src-date-year" type="text" inputmode="numeric">
                            </div>
                        </div>
                    </div>
                </fieldset>
            </div>
        </div>
        <div class="govuk-grid-row">
            <div class="govuk-grid-column-three-quarters"
                style="display: flex; justify-content: center; gap: 10px; flex-wrap: wrap;">
                <div>
                    <label class="govuk-label govuk-fieldset__legend--m" style=inherit>Source timezone</label>
                    <div id="source-buttons">
                        <button type="button" class="govuk-button govuk-button--secondary govuk-tag--orange"
                            onclick="selectSource('Europe/London', this)">London</button>
                        <button type="button" class="govuk-button govuk-button--secondary govuk-tag--yellow"
                            onclick="selectSource('America/New_York', this)">New York</button>
                        <button type="button" class="govuk-button govuk-button--secondary govuk-tag--purple"
                            onclick="selectSource('America/Los_Angeles', this)">Los Angeles</button>
                        <button type="button" class="govuk-button govuk-button--secondary govuk-tag--blue"
                            onclick="selectSource('CET', this)">Central Europe</button>
                        <button type="button" class="govuk-button govuk-button--secondary govuk-tag--green"
                            onclick="selectSource('UTC', this)">UTC</button>
                    </div>
                </div>
                <div>
                    <label class="govuk-label govuk-fieldset__legend--m">Destination timezone</label>
                    <div id="destination-buttons">
                        <button type="button" class="govuk-button govuk-button--secondary govuk-tag--orange"
                            onclick="selectDestination('Europe/London', this)">London</button>
                        <button type="button" class="govuk-button govuk-button--secondary govuk-tag--yellow"
                            onclick="selectDestination('America/New_York', this)">New York</button>
                        <button type="button" class="govuk-button govuk-button--secondary govuk-tag--purple"
                            onclick="selectDestination('America/Los_Angeles', this)">Los Angeles</button>
                        <button type="button" class="govuk-button govuk-button--secondary govuk-tag--blue"
                            onclick="selectDestination('CET', this)">Central Europe</button>

                        <button type="button" class="govuk-button govuk-button--secondary govuk-tag--green"
                            onclick="selectDestination('UTC', this)">UTC</button>
                    </div>
                </div>
            </div>
            <div class="govuk-grid-column-one-quarter" style="display: flex; justify-content: right;">
                <button type="submit" class="govuk-button govuk-button--warning" data-module="govuk-button"
                    onclick="clr()" id="btn-reset">
                    Reset
                </button>
            </div>
        </div>


        <div class="govuk-grid-row">
            <div class="govuk-form-group govuk-grid-column-one-quarter"> <!-- dest time -->
                <label class="govuk-label govuk-fieldset__legend--m" for="width-2">
                    Destination
                </label>
                <div class="govuk-input__wrapper">
                    <input
                        class="govuk-input govuk-input--width-4 govuk-input--extra-letter-spacing govuk-!-font-weight-bold"
                        id="dest-time" name="dest-time" type="text" spellcheck="false" readonly="true" disabled="true">
                    <div class="govuk-input__suffix" id="dest-suff" aria-hidden="true"></div>

                </div>
            </div>

            <div class="govuk-form-group govuk-grid-column-one-quarter"> <!-- dest time -->
                <label class="govuk-label govuk-fieldset__legend" for="preset">
                    Preset
                </label>
                <div class="govuk-input__wrapper">
                    <input class="govuk-input govuk-input--width-6" id="preset" name="preset" type="text"
                        spellcheck="false" readonly="true" disabled="true" style="margin-top: 10px;">

                </div>
            </div>

            <div class="govuk-form-group govuk-grid-column-one-quarter"> <!--UTC Time-->
                <label class="govuk-label govuk-fieldset__legend" for="width-2">
                    UTC
                </label>
                <div class="govuk-input__wrapper">
                    <input
                        class="govuk-input govuk-input--width-4 govuk-input--extra-letter-spacing govuk-!-font-weight-bold"
                        id="utc-time" name="utc-time" type="text" spellcheck="false" readonly="true" disabled="true"
                        style="margin-top: 10px;">

                </div>

            </div>
        </div>
    </main>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.30.1/moment-with-locales.min.js"
    integrity="sha512-4F1cxYdMiAW98oomSLaygEwmCnIP38pb4Kx70yQYqRwLVCs3DbRumfBq82T08g/4LJ/smbFGFpmeFlQgoDccgg=="
    crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment-timezone/0.5.46/moment-timezone-with-data-10-year-range.js"
    integrity="sha512-s932Fui209TZcBY5LqdHKbANLKNneRzBib2GE3HkZUQtoWY3LBUN2kaaZDK7+8z8WnFY23TPUNsDmIAY1AplPg=="
    crossorigin="anonymous" referrerpolicy="no-referrer"></script>


<script>
    //fill defaults
    document.getElementById('src-date-day').value = moment().format("DD");
    document.getElementById('src-date-month').value = moment().format("MM");
    document.getElementById('src-date-year').value = moment().format("YYYY");
    document.getElementById('src-time').value = moment().format("HHmm");
    document.getElementById('dest-suff').innerHTML = "tz";



    //const timezones
    const utc = "UTC";
    const ny = "America/New_York";
    const lo = "Europe/London";
    const la = "America/Los_Angeles";
    const de = "Europe/Berlin";
    const cet = "CET"


    function convertTz(srcTz, destTz, presetVal, destSuff, destSuffTitle) {
        let srcTime = document.getElementById('src-time').value;
        let srcDateDay = document.getElementById('src-date-day').value;
        let srcDateMonth = document.getElementById('src-date-month').value;
        let srcDateYear = document.getElementById('src-date-year').value;

        let parsed = moment.tz(
            `${srcDateYear}-${srcDateMonth}-${srcDateDay} ${srcTime.match(/\d{2}/g).join(":")}`,
            srcTz
        );
        console.log("parsing input", parsed.format());

        let destTime = parsed.clone().tz(destTz).format("HH:mm");
        let utcTime = parsed.clone().utc().format("HH:mm");
        console.log("destTime", destTime);
        console.log("utcTime", utcTime);

        document.getElementById('dest-time').value = destTime;
        document.getElementById('utc-time').value = utcTime;
        document.getElementById('preset').value = presetVal;
        document.getElementById('dest-suff').innerHTML = destSuff;
        document.getElementById('dest-suff').title = destSuffTitle;
    }

    // Now, each function is just a one-liner:
    function cetlo() { convertTz(de, lo, "CETLO", "LO", lo); }
    function cetny() { convertTz(cet, ny, "CETNY", "NY", ny); }
    function cetla() { convertTz(cet, la, "CETLA", "LA", la); }
    function cetutc() { convertTz(cet, utc, "CETUTC", "UTC", utc); }

    function lalo() { convertTz(la, lo, "LALO", "LO", lo); }
    function lany() { convertTz(la, ny, "LANY", "NY", ny); }
    function lacet() { convertTz(la, cet, "LACET", "CET", cet); }
    function lautc() { convertTz(la, utc, "LAUTC", "UTC", utc); }

    function lola() { convertTz(lo, la, "LOLA", "LA", la); }
    function locet() { convertTz(lo, cet, "LODE", "DE", cet); }
    function lony() { convertTz(lo, ny, "LONY", "NY", ny); }
    function loutc() { convertTz(lo, utc, "LOUTC", "UTC", utc); }

    function nycet() { convertTz(ny, cet, "NYCET", "CET", cet); }
    function nyla() { convertTz(ny, la, "NYLA", "LA", la); }
    function nylo() { convertTz(ny, lo, "NYLO", "LO", lo); }
    function nyutc() { convertTz(ny, utc, "NYUTC", "UTC", utc); }

    function utcny() { convertTz(utc, ny, "UTCNY", "NY", ny); }
    function utcla() { convertTz(utc, la, "UTCLA", "LA", la); }
    function utclo() { convertTz(utc, lo, "UTCLO", "LO", lo); }
    function utccet() { convertTz(utc, cet, "UTCCET", "CET", cet); }



    function clr() {
        document.getElementById('src-time').value = moment().format("HHmm");
        document.getElementById('src-date-day').value = moment().format("DD");
        document.getElementById('src-date-month').value = moment().format("MM");
        document.getElementById('src-date-year').value = moment().format("YYYY");
        document.getElementById('dest-time').value = "";
        document.getElementById('utc-time').value = "";
        //  document.getElementById('rec-time').value = "";
        document.getElementById('preset').value = "";
        document.getElementById('dest-suff').innerHTML = "tz";
        console.log("cleared");
    }

    addEventListener("keypress", function (event) {
        //reset key
        if (event.key === "r") {
            document.getElementById("btn-reset").click();
        }
    });

    let selectedSource = null;
    let selectedDestination = null;
    let selectedSourceBtn = null;
    let selectedDestinationBtn = null;

    function selectSource(tz, btn) {
        selectedSource = tz;
        if (selectedSourceBtn) selectedSourceBtn.classList.remove('govuk-button--selected');
        btn.classList.add('govuk-button:focus');
        selectedSourceBtn = btn;
    }

    function selectDestination(tz, btn) {
        selectedDestination = tz;
        if (selectedDestinationBtn) selectedDestinationBtn.classList.remove('govuk-button--selected');
        btn.classList.add('govuk-button:focus');
        selectedDestinationBtn = btn;
        // Only convert if both are selected and not the same
        if (selectedSource && selectedDestination && selectedSource !== selectedDestination) {
            let presetVal = getShortTz(selectedSource) + '-' + getShortTz(selectedDestination);
            let destSuff = getShortTz(selectedDestination);
            convertTz(selectedSource, selectedDestination, presetVal, destSuff, selectedDestination);
        }
    }

    function getShortTz(tz) {
        if (tz === "Europe/London") return "LO";
        if (tz === "America/New_York") return "NY";
        if (tz === "Europe/Berlin" || tz === "CET") return "CET";
        if (tz === "America/Los_Angeles") return "LA";
        if (tz === "UTC") return "UTC";
        return tz;
    }

</script>
{% endblock %}